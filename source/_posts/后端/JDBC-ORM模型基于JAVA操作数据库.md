---
title: "JDBC ORM模型基于JAVA操作数据库"
date: 2020-04-11T16:45:08+08:00
draft: true
categories: 
    - "后端"
tags: 
    - "数据库"
    - "MySQL"    
---

在我们日常的开发过程中，肯定不可避免的会使用到数据库以及 SQL 语句。比如，刚开始学习 Java 的时候可能会遇到 JDBC，它是连接 Java 和数据库的桥梁，我们可以使用 JDBC 来建立与数据库之间的连接并且执行相应的 SQL 语句。虽然 JDBC 的执行效率很高，但是其开发效率比较低。正是如此，市面上出现了一大批 ORM（对象关系映射）框架，例如 Hibernate，iBATIS 以及本文将要介绍的 MyBatis。

<!--more-->

## JDBC

JDBC (Java Database Connectivity) API，即Java数据库编程接口，是一组标准的Java语言中的接口和类，使用这些接口和类，Java客户端程序可以访问各种不同类型的数据库。比如建立数据库连接、执行SQL语句进行数据的存取操作。

**实现步骤**

1. 使用JDBC编程需要连接数据库，注册驱动和数据库信息
1. 操作Connection，打开 Statement 对象 
1. 通过Statement执行SQL， 返回结果到ResultSet对象
1. 使用ResultSet读取数据，然后通过代码转化为具体的POJO对象
1. 关闭数据库的相关资源

**优点**

1. 直接底层操作，提供了很简单、便捷的访问数据库的方法，跨平台性比较强。
1. 灵活性比较强。可以写很复杂的SQL语句。

**缺点** 

1. 工作量相对较大。我们需要先连接，然后处理JDBC底层事务，处理数据类型。
1. 我们还需要操作Connection对象、Statement对象和ResultSet对象去拿到数据，并准确的关闭它们。

## ORM

由于JDBC存在的缺陷，所以我们在实际工作中很少使用JDBC进行操作数据库的编程。于是我们就提出了对象关系映射（Object Relational Mapping）简称 ORM，或者O/RM，或者 O/R mapping。

ORM模型就是数据库的表和简单Java对象（Plain Ordinary Java Object，简称POJO）的映射关系模型。   它主要解决数据库数据和POJO对象的相互映射。我们通过这层映射就可以简单的把数据库表的数据转化为POJO。以便程序员更加容易的理解和应用Java程序.而且程序员一般只需要了解Java应用而无需对数据库进行深入的了解。此外，ORM模型提供了统一的规则使得数据库的数据通过配置便可轻易的映射到POJO上。常用的ORM框架 

### Java ORM

#### MyBatis

MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。

**优点**

1. 易于上手和掌握。
1. sql写在xml里，便于统一管理和优化。
1. 解除sql与程序代码的耦合。
1. 提供映射标签，支持对象与数据库的orm字段关系映射提供对象关系映射标签，支持对象关系组建维护提供xml标签，支持编写动态sql。

**缺点**

1. sql工作量很大，尤其是字段多、关联表多时，更是如此。
1. sql依赖于数据库，导致数据库移植性差。
1. 由于xml里标签id必须唯一，导致DAO中方法不支持方法重载。
1. 字段映射标签和对象关系映射标签仅仅是对映射关系的描述，具体实现仍然依赖于sql。（比如配置了一对多Collection标签，如果sql里没有join子表或查询子表的话，查询后返回的对象是不具备对象关系的，即Collection的对象为null）
1. DAO层过于简单，对象组装的工作量较大。
1. 不支持级联更新、级联删除。
1. 编写动态sql时,不方便调试，尤其逻辑复杂时。
1. 提供的写动态sql的xml标签功能简单（连struts都比不上），编写动态sql仍然受限，且可读性低。
1. 若不查询主键字段，容易造成查询出的对象有“覆盖”现象。参数的数据类型支持不完善。（如参数为Date类型时，容易报没有get、set方法，需在参数上加@param）
1. 多参数时，使用不方便，功能不够强大。（目前支持的方法有map、对象、注解@param以及默认采用012索引位的方式）
1. 缓存使用不当，容易产生脏数据。

#### Hibernate

Hibernate是一种Java语言下的对象关系映射(ORM)解决方案。它是使用GNU宽通用公共许可证发行的自由、开源的软件。它为面向对象的领域模型到传统的关系型数据库的映射，提供了一个使用方便的持久化框架。

**优点**

1. 消除了代码的映射规则，它全部被分离到XML或者注解里面去配置。
1. 无需再管理数据库连接，它也配置到XML里面。
1. 一个会话中，不要操作多个对象，只要操作Sesison即可。
1. 关闭资源只需要关闭一个Session即可。

**缺点**

1. 全表映射带来的不便，比如更新时需要发送所有的字段。
1. 无法根据不同的条件组装不同的SQL。　
1. 对多表关联和复杂的SQL查询支持较差。
1. 需要自己写SQL，返回后，需要自己将数据组装到POJO中。
1. 不能有效支持存储过程。虽然有HQL，但是性能较差，大型互联网往往需要优化SQL，而Hibernate做不到。

### 框架选择        

Hibernate作为Java ORM框架，它确实编程简易，需要我们提供映射的规则，完全可以通过IDE生成。同时无需编写SQL确实开发效率优于MyBatis。而且，它也提供了缓存、日志、级联、等强大的功能，但是Hibernate的缺陷也是十分的明显的。就是在多表关联复杂的SQL时，数据系统权限限制时，根据条件变化的SQL时。存储过程等使用场景。Hibernate十分不便。而性能又难以通过SQL来优化。所以Hibernate一般只适用于场景不太复杂的、性能要求不太苛刻的时候使用。    

MyBatis 是一个灵活的、可以动态生成映射关系的框架，它几乎可以替代JDBC。拥有动态列、动态表名，存储过程都支持。同时提供了简易的缓存（如(默认)一级缓存，还有二级缓存）、日志、级联。但是它的缺陷是需要你提供映射规则和SQL，所以它的开发工作量一般要比Hibernate略大一些。

但总体来说，MyBatis具有高度灵活、可优化、易维护等特点, 所以目前还是myBatis比较合适我们。
